{% extends "Voter/header.html" %}
{% load static %}

{% block title %}Digital Ballot{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'Voter/votingPg.css' %}">
<div class="main">
    <h2>Digital Ballot Paper</h2>
    <form method="post" action="{% url 'cast_vote' %}" id="ballotForm" onsubmit="return validateForm()">
        {% csrf_token %}
        <div class="ballot-paper">
            {% for candidate in candidates %}
            <div class="candidate-row">
                <div class="candidate">
                    <label>
                        {% if candidate.profile_picture %}
                        <img src="{{ candidate.profile_picture.url }}" alt="{{ candidate.candidate.full_name }}">
                        {% else %}
                        <img src="{% static 'images/default_candidate.jpg' %}" alt="{{ candidate.candidate.full_name }}">
                        {% endif %}
                    </label>
                    <span class="party-name">{{ candidate.candidate.full_name }}</span>
                    <span class="party-name">{{ candidate.candidate.party.party_name }}</span>
                    <input type="checkbox" name="candidate" value="{{ candidate.candidate.user_id }}" class="candidate-checkbox">
                </div>
            </div>
            {% endfor %}
        </div>
        <div class="vote-button-container">
            <button type="submit">Submit</button>
        </div>
    </form>

    {% if messages %}
        <div class="errors" id="messages">
            {% for message in messages %}
            {% if message %}
            <p class="error">{{ message }}</p>
            {% endif %}
            {% endfor %}
        </div>
    {% endif %}
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const messagesContainer = document.getElementById("messages");
        if (messagesContainer) {
            setTimeout(() => {
                messagesContainer.innerHTML = "";
            }, 3000);
        }

        // Limit selection to one checkbox
        const checkboxes = document.querySelectorAll('.candidate-checkbox');
        checkboxes.forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                checkboxes.forEach(box => {
                    if (box !== this) box.checked = false;
                });
            });
        });
    });

    function validateForm() {
        // Get all checkboxes with name "candidate"
        var checkboxes = document.querySelectorAll('input[name="candidate"]');
        var checked = false;

        // Loop through checkboxes to see if at least one is checked
        checkboxes.forEach(function(checkbox) {
            if (checkbox.checked) {
                checked = true;
            }
        });

        // If no checkbox is checked, show alert and prevent form submission
        if (!checked) {
            alert("Please select at least one candidate.");
            return false; // Prevent form submission
        }

        return true; // Allow form submission
    }
</script>

{% endblock %}
